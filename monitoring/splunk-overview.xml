<?xml version='1.0' encoding='utf-8'?>
<dashboard>
  <label>Membership User API Overview</label>
  <row>
    <chart>
      <searchString>host=ftweb03400-lvpr-uk-int source="/var/log/apps/userapi/userapi-access.log" method="POST" uri_path="/membership/users/v1" | timechart span=10m perc99(dw_resptime) as 99th_percentile, perc95(dw_resptime) as 95th_percentile</searchString>
      <title>User API 01 POST user latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>host=ftweb03401-lvpr-uk-int source="/var/log/apps/userapi/userapi-access.log" method="POST" uri_path="/membership/users/v1" | timechart span=10m perc99(dw_resptime) as 99th_percentile, perc95(dw_resptime) as 95th_percentile</searchString>
      <title>User API 02 POST user latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source="/var/log/apps/userapi/userapi-access.log" method="POST" uri_path="/membership/users/v1" | timechart span=1m count by host</searchString>
      <title>User API POST user throughput</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">calls/minute</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  
  <!-- Janrain client -->
  <row>
    <chart>
      <searchString>host=ftweb03400-lvpr-uk-int source=/var/log/apps/userapi/userapi.log event="jerseyClientResponseTime" method="POST" uri_path="/entity*" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API 01 Janrain POST latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>host=ftweb03401-lvpr-uk-int source=/var/log/apps/userapi/userapi.log event="jerseyClientResponseTime" method="POST" uri_path="/entity*" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API 02 Janrain POST latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="jerseyClientResponseTime" method="POST" uri_path="/entity*" | timechart span=1m count by host</searchString>
      <title>User API Janrain POST throughput</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">calls/minute</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  
  <!-- Kafka  -->
  <row>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="kafkaMessageReceived" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API Kafka message reception latency (end to end)</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="kafkaMessageReceived" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API Kafka message send latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="kafkaMessageSent" | timechart span=1m count by host</searchString>
      <title>User API Kafka message receive throughput</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">calls/minute</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="kafkaMessageSent" | timechart span=1m count by host</searchString>
      <title>User API Kafka message send throughput</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">calls/minute</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  
  <!-- Cassandra -->
  <row>
    <chart>
      <searchString>host=ftweb03400-lvpr-uk-int source=/var/log/apps/userapi/userapi.log event="cassandraStatementExecuted" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API 01 Cassandra call latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>host=ftweb03401-lvpr-uk-int source=/var/log/apps/userapi/userapi.log event="cassandraStatementExecuted" | eval elapsed_ms=elapsed_ns/1000000 | timechart span=10m perc99(elapsed_ms) as 99th_percentile, perc95(elapsed_ms) as 95th_percentile</searchString>
      <title>User API 02 Cassandra call latency</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">Latency (ms)</option>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log event="cassandraStatementExecuted" | timechart span=1m count by host</searchString>
      <title>User API Cassandra call throughput</title>
      <earliestTime>-1h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisLabelsY.majorUnit"/>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">calls/minute</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.primaryAxisTitle.text"/>
      <option name="charting.secondaryAxisTitle.text"/>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  
  <!-- Janrain connection pool gauges + error rate gauge -->
  <row>
    <chart>
      <searchString>host=ftweb03400-lvpr-uk-int source=/var/log/metrics/userapi/userapi-metrics.log metricName="org.apache.http.conn.ClientConnectionManager.janrain-capture-jersey-client.leased-connections" | stats mean(value) as leasedConnections | eval roundedLeasedConnections = round(leasedConnections) | gauge roundedLeasedConnections 0 100 500 1024</searchString>
      <title>User API 01 Janrain connection pool leased connections</title>
      <earliestTime>-1m</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">radialGauge</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>host=ftweb03401-lvpr-uk-int source=/var/log/metrics/userapi/userapi-metrics.log metricName="org.apache.http.conn.ClientConnectionManager.janrain-capture-jersey-client.leased-connections" | stats mean(value) as leasedConnections | eval roundedLeasedConnections = round(leasedConnections) | gauge roundedLeasedConnections 0 100 500 1024</searchString>
      <title>User API 02 Janrain connection pool leased connections</title>
      <earliestTime>-1m</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">radialGauge</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>source=/var/log/apps/userapi/userapi.log | stats count(eval(logLevel="ERROR")) as errors | rangemap   field=errors    low=0-10   elevated=10-20    default=severe</searchString>
      <title>5 minute error rate</title>
      <earliestTime>-5m</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">radialGauge</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
</dashboard>